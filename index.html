<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>情緒煉金術 3.0 - 演化生命體</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #050508; overflow: hidden; color: #fff; font-family: sans-serif; }
        canvas { filter: blur(0.4px) contrast(1.1); }
        .hud { text-shadow: 0 0 10px rgba(99, 102, 241, 0.5); }
    </style>
</head>
<body class="flex flex-col items-center justify-end h-screen">

    <canvas id="canvas" class="absolute inset-0 w-full h-full"></canvas>

    <div class="relative z-10 w-full max-w-lg p-8 mb-6">
        <div class="bg-black/20 backdrop-blur-md rounded-3xl p-6 border border-white/5 shadow-2xl">
            <div id="plant-status" class="hud text-xs uppercase tracking-widest text-indigo-400 mb-2">植物狀態：待喚醒...</div>
            <textarea id="input" 
                class="w-full bg-transparent border-none focus:ring-0 text-lg placeholder-gray-700 resize-none h-20 text-indigo-100" 
                placeholder="輸入今天的壓力來源..."></textarea>
            
            <div class="flex justify-between items-center mt-4">
                <div id="energy-bar" class="h-1 w-32 bg-gray-800 rounded-full overflow-hidden">
                    <div id="energy-fill" class="h-full bg-indigo-500 transition-all duration-1000" style="width: 20%"></div>
                </div>
                <button onclick="feedPlant()" 
                    class="bg-white text-black hover:bg-indigo-400 hover:text-white px-8 py-2 rounded-full font-bold transition-all active:scale-95">
                    注入能量
                </button>
            </div>
        </div>
    </div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const input = document.getElementById('input');
const energyFill = document.getElementById('energy-fill');
const statusLabel = document.getElementById('plant-status');

let width, height;
// 植物的核心基因
let plantDNA = {
    branches: [],
    baseHue: 200,
    stressLevel: 0,
    growthProgress: 0.2, // 初始生長度
    richness: 1.5       // 分枝豐富度
};

function resize() {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
    drawScene(); // 尺寸改變重繪
}
window.addEventListener('resize', resize);
resize();

// 初始化一株隨機的小植物
function initPlant() {
    plantDNA.baseHue = Math.random() * 360;
    plantDNA.stressLevel = 0;
    plantDNA.growthProgress = 0.3;
    drawScene();
}

function drawScene() {
    ctx.clearRect(0, 0, width, height);
    // 繪製微弱的地平線光芒
    const grad = ctx.createRadialGradient(width/2, height, 0, width/2, height, height/2);
    grad.addColorStop(0, `hsla(${plantDNA.baseHue}, 30%, 10%, 1)`);
    grad.addColorStop(1, 'transparent');
    ctx.fillStyle = grad;
    ctx.fillRect(0,0,width,height);

    // 從底部中心生長
    renderTree(width/2, height - 50, -Math.PI/2, 80 * plantDNA.growthProgress, 8, plantDNA.baseHue);
}

function renderTree(x, y, angle, len, thickness, hue) {
    if (len < 5) {
        // 繪製發光花朵 (只在成熟時出現)
        if (plantDNA.growthProgress > 0.6) {
            ctx.beginPath();
            ctx.arc(x, y, 3 + (plantDNA.stressLevel * 2), 0, Math.PI * 2);
            ctx.fillStyle = `hsla(${hue + 40}, 80%, 70%, 0.8)`;
            ctx.shadowBlur = 15;
            ctx.shadowColor = `hsla(${hue + 40}, 100%, 50%, 1)`;
            ctx.fill();
        }
        return;
    }

    const nextX = x + Math.cos(angle) * len;
    const nextY = y + Math.sin(angle) * len;

    ctx.beginPath();
    ctx.strokeStyle = `hsla(${hue}, 60%, ${30 + plantDNA.stressLevel * 5}%, 0.8)`;
    ctx.lineWidth = thickness;
    ctx.lineCap = 'round';
    ctx.moveTo(x, y);
    ctx.lineTo(nextX, nextY);
    ctx.stroke();

    // 關鍵：根據 DNA 決定分支
    const numBranches = plantDNA.richness > 2 ? 3 : 2;
    for (let i = 0; i < numBranches; i++) {
        const nextAngle = angle + (Math.random() - 0.5) * 0.6;
        const nextLen = len * (0.65 + Math.random() * 0.15);
        renderTree(nextX, nextY, nextAngle, nextLen, thickness * 0.7, hue);
    }
}

function feedPlant() {
    const text = input.value.trim();
    if (!text) return;

    // 模擬吸收過程
    statusLabel.innerText = "吸收情緒中...";
    
    // 根據輸入內容更新 DNA
    const addedEnergy = Math.min(text.length / 50, 0.2);
    plantDNA.growthProgress = Math.min(plantDNA.growthProgress + addedEnergy, 1.5);
    plantDNA.stressLevel = Math.min(plantDNA.stressLevel + (text.length / 20), 10);
    
    // 改變顏色：如果輸入強烈詞彙
    if (text.includes("氣") || text.includes("怒") || text.includes("煩")) {
        plantDNA.baseHue -= 20; // 偏向紅色
        plantDNA.richness += 0.5; // 變得更尖銳茂密
    } else {
        plantDNA.baseHue += 10; // 偏向冷色
    }

    // 更新進度條
    energyFill.style.width = (plantDNA.growthProgress * 60) + "%";

    // 平滑重繪 (加入一點點震動效果)
    let frames = 0;
    const animateGrowth = () => {
        drawScene();
        if (frames++ < 30) requestAnimationFrame(animateGrowth);
        else statusLabel.innerText = "進化完成。";
    };
    animateGrowth();

    input.value = "";
}

initPlant();
</script>
</body>
</html>
